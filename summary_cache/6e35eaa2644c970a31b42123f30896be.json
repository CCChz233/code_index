{"summary": "- The code defines a pytest fixture `s3_base` for mocking S3 interactions using the Moto server.\n- It sets environment variables for AWS credentials.\n- In CI (GitHub) environment, it skips tests on Windows, macOS, or ARM.\n- For CI, it yields a URL\u00a0:\u00a0`http://localhost:5000`\u00a0provided by\u00a0\u00a0\u00a0\u00a0.\n- For local (not\u00a0\u00a0)\u00a0\u00a0\u00a0\u00a0...\n```\n\n- \u5b9a\u4e49\u4e86 pytest fixture `s3_base`\uff0c\u7528\u4e8e\u5728\u6d4b\u8bd5\u4e2d\u6a21\u62df S3 \u670d\u52a1\uff0c\u4f9d\u8d56 Moto \u670d\u52a1\u5668\u63d0\u4f9b\u7684\u672c\u5730 S3 \u63a5\u53e3\u3002  \n- \u9996\u5148\u901a\u8fc7 `monkeysession.setenv` \u8bbe\u7f6e AWS \u8bbf\u95ee\u5bc6\u94a5\u3001\u5bc6\u94a5 ID \u4e0e\u533a\u57df\uff0c\u4ee5\u6ee1\u8db3 SDK \u8c03\u7528\u7684\u57fa\u672c\u8ba4\u8bc1\u9700\u6c42\u3002  \n- \u5f53\u68c0\u6d4b\u5230\u5728 GitHub CI \u73af\u5883 (`GithubCI.get()`) \u4e14\u8fd0\u884c\u5e73\u53f0\u4e3a Windows\u3001macOS \u6216 ARM \u67b6\u6784\u65f6\uff0c\u76f4\u63a5\u8df3\u8fc7 S3 \u76f8\u5173\u6d4b\u8bd5\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u5e73\u53f0\u4e0d\u652f\u6301 Moto \u7684\u5bb9\u5668\u670d\u52a1\u3002  \n- \u82e5\u5728 CI \u73af\u5883\u4e14\u5e73\u53f0\u7b26\u5408\u8981\u6c42\uff0c\u5219\u5047\u8bbe\u5df2\u5728 Docker \u4e2d\u542f\u52a8\u4e86 Moto \u670d\u52a1\u5668\uff0c\u76f4\u63a5\u8fd4\u56de\u56fa\u5b9a\u7684\u672c\u5730 URL `http://localhost:5000` \u4f9b\u540e\u7eed\u6d4b\u8bd5\u4f7f\u7528\u3002  \n- \u82e5\u5728\u672c\u5730\u73af\u5883\uff08\u975e CI\uff09\uff0c\u5219\u4e3a\u6bcf\u4e2a pytest worker \u5206\u914d\u72ec\u7acb\u7684\u7aef\u53e3\uff08master \u4f7f\u7528 5500\uff0c\u5176\u4f59 worker \u4f7f\u7528 5550+worker_id\uff09\uff0c\u901a\u8fc7 `subprocess.Popen` \u542f\u52a8 Moto \u670d\u52a1\u5668\u8fdb\u7a0b\u5e76\u76d1\u542c\u5bf9\u5e94\u7aef\u53e3\u3002  \n- \u542f\u52a8\u540e\u5faa\u73af\u6700\u591a 50 \u6b21\u5c1d\u8bd5\u901a\u8fc7 `requests.get` \u68c0\u6d4b\u670d\u52a1\u5668\u662f\u5426\u53ef\u7528\uff0c\u82e5\u6210\u529f\u5219 `yield` \u8be5 endpoint URI\uff1b\u82e5\u5168\u90e8\u5c1d\u8bd5\u5931\u8d25\uff0c\u5219\u7ec8\u6b62\u8fdb\u7a0b\u5e76\u629b\u51fa\u8fd0\u884c\u65f6\u9519\u8bef\u3002  \n- \u6d4b\u8bd5\u7ed3\u675f\u540e\uff0cfixture \u81ea\u52a8\u5173\u95ed Moto \u8fdb\u7a0b\uff0c\u786e\u4fdd\u8d44\u6e90\u6e05\u7406\u3002  \n\n**\u8f93\u5165**\uff1a`worker_id`\uff08pytest worker \u6807\u8bc6\uff09\uff0c`monkeysession`\uff08\u7528\u4e8e\u4fee\u6539\u73af\u5883\u53d8\u91cf\u7684 pytest fixture\uff09\u3002  \n**\u8f93\u51fa**\uff1a\u8fd4\u56de\u53ef\u7528\u7684 Moto S3 \u670d\u52a1 URL\uff08\u672c\u5730\u6216 CI \u73af\u5883\uff09\uff0c\u4f9b\u6d4b\u8bd5\u4ee3\u7801\u4f7f\u7528\u3002", "prompt_id": "28ad819ea97a795ed2ae85e64d974c5c", "created_at": "2026-02-04T20:41:43.099304"}