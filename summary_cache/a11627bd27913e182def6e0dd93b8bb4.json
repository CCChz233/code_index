{"summary": "The code defines a function ``map_to_gjson`......... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... \nWe need to produce a summary in Chinese (or Chinese/English). The code is from instructor/utils.py. It imports many modules, defines logger, type variables, etc. The main function defined is map_to_gemini_function_schema which maps an OpenAPI schema dict to a Gemini function call schema. It uses jsonref to resolve $ref references, defines a Pydantic BaseModel subclass FunctionSchema with fields like description, enum, example, format, nullable, items, required, type, properties. It then resolves references, removes $defs, recursively adds \"format\": \"enum\" for any enum fields, then creates a FunctionSchema instance from the dict and returns its dict representation excluding None/unset fields.\n\nThus the business logic: input is a dict representing an OpenAPI schema (possibly with $ref). Output is a dict representing a Gemini function schema, with enum fields annotated with format \"enum\". It uses jsonref to resolve references, and Pydantic for validation and serialization.\n\nAlso there are other imports and type definitions but not used in this snippet. The function is the core.\n\nThus summary: The function transforms OpenAPI schema to Gemini function schema, handling $ref resolution, enum formatting, and returns a cleaned dict.\n\nWe need to start directly with the summary content, no preamble. Use Chinese. Provide business logic, inputs, outputs.\n\nLet's produce.assistantfinal\u5c06 OpenAPI JSON\u2011Schema\uff08\u53ef\u80fd\u5305\u542b `$ref` \u5f15\u7528\uff09\u8f6c\u6362\u4e3a Google Gemini \u51fd\u6570\u8c03\u7528\u6240\u9700\u7684 schema\u3002  \n**\u8f93\u5165**\uff1a`obj: dict[str, Any]` \u2014\u2014 \u4e00\u4e2a\u7b26\u5408 OpenAPI \u89c4\u8303\u7684 schema \u5bf9\u8c61\u3002  \n**\u5904\u7406\u6d41\u7a0b**  \n1. \u4f7f\u7528 `jsonref.replace_refs` \u9012\u5f52\u5c55\u5f00\u6240\u6709 `$ref`\uff0c\u5f97\u5230\u5b8c\u6574\u7684 JSON\u2011Schema \u5e76\u53bb\u9664 `$defs`\u3002  \n2. \u9012\u5f52\u904d\u5386\u5f97\u5230\u7684\u5b57\u5178\uff0c\u82e5\u952e\u4e3a `enum`\uff0c\u5728\u540c\u5c42\u52a0\u5165 `\"format\": \"enum\"`\uff0c\u4ee5\u6ee1\u8db3 Gemini \u5bf9\u679a\u4e3e\u7684\u683c\u5f0f\u8981\u6c42\u3002  \n3. \u5b9a\u4e49\u5185\u90e8 Pydantic \u6a21\u578b `FunctionSchema`\uff0c\u5b57\u6bb5\u8986\u76d6 OpenAPI \u4e2d\u5e38\u89c1\u5c5e\u6027\uff08`type\u3001description\u3001enum\u3001items\u3001properties\u3001required` \u7b49\uff09\uff0c\u5e76\u901a\u8fc7 `FunctionSchema(**schema)` \u5bf9\u5c55\u5f00\u540e\u7684 schema \u8fdb\u884c\u7ed3\u6784\u6821\u9a8c\u3002  \n4. \u8c03\u7528 `", "prompt_id": "28ad819ea97a795ed2ae85e64d974c5c", "created_at": "2026-02-04T20:40:23.257328"}