{"summary": "We need to summarize the functionality of the code snippet. The code appears to be a Python script (tools/gen.py) that generates a C header file for aiohttp. It imports modules, defines constants, calculates headers, builds a dictionary, defines a template for C code with macros and functions to find header indices. It defines functions gen_prefix, etc. The code snippet is incomplete but we can infer that it reads header definitions from aiohttp/hdrs.py, builds a lookup structure (maybe a tree) for fast header name lookup, and writes a C source file with a function find_header that uses a switch-case chain to match header strings to indices. The script uses a \"ROOT\" path, calculates headers, builds a dictionary, defines a template for the C code with macros and functions, and defines a function gen_prefix that modifies a prefix based on a key.\n\nWe need to produce a summary in Chinese (with some English if needed). The summary should start directly with the content, no preamble. Should focus on business logic, inputs, outputs. So we need to describe that the script reads header definitions from aiohttp/hdrs.py, builds a decision tree for header name lookup, and generates a C source file containing a function find_header that returns the index of a header given its string and length, or -1 if not found. The script uses templates (HEADER, BLOCK, CASE, FOOTER) to generate the C code. It also defines a function gen_prefix to generate macro prefixes for header constants.\n\nThus the summary: The script is a code generator for aiohttp's header lookup. It takes the root directory, reads header definitions, builds a nested dict mapping characters to next states, then writes a C file with a switch-case based state machine to find header indices. The output is a C header file (maybe _find_header.h) that can be compiled into aiohttp.\n\nNow produce the answer.assistantfinal\u8bfb\u53d6\u9879\u76ee\u6839\u76ee\u5f55\u4e0b `aiohttp/hdrs.py` \u4e2d\u5b9a\u4e49\u7684 HTTP \u5934\u90e8\u540d\u79f0\u5217\u8868\uff0c\u6784\u5efa\u4ee5\u5b57\u7b26\u4e3a\u952e\u7684\u591a\u5c42\u5b57\u5178\uff08\u72b6\u6001\u673a\uff09\uff0c\u5e76\u4f9d\u636e\u8be5\u5b57\u5178\u751f\u6210 C \u8bed\u8a00\u6e90\u7801\u6587\u4ef6\u3002  \n\u751f\u6210\u7684 C \u6587\u4ef6\u5305\u542b\u5b8f\u5b9a\u4e49\u3001`find_header(const char *str, int size)` \u51fd\u6570\u4ee5\u53ca\u4e00\u7cfb\u5217 `switch`/`case` \u4ee3\u7801\u5757\uff1a  \n- `HEADER`\u3001`BLOCK`\u3001`CASE`\u3001`FOOTER` \u4e3a\u4ee3\u7801\u6a21\u677f\uff0c`NEXT_CHAR()` \u5b8f\u8d1f\u8d23\u904d", "prompt_id": "28ad819ea97a795ed2ae85e64d974c5c", "created_at": "2026-02-04T20:32:56.233287"}