{"summary": "- This module defines functions for handling JSON response modes in OpenAI chat completions.\n- The `handle_json_modes` function takes a Pydantic model `response_model` (type of `BaseModel`), a dictionary `new_kwargs` (containing `messages` and possibly other parameters), and a `Mode` enum enum.\n- It constructs a system message (the `message` variable) that instructs **the** (the user? ) **...**.\nWe need to produce a summary in Chinese (or Chinese/English). Must start directly with the summary content, no preamble. Focus on business logic, inputs, outputs. Provide concise description.\n\nWe have code snippet: instructor/process_response.py. It imports many modules. The function handle_json_modes is defined. It takes response_model (type[T] subclass of BaseModel), new_kwargs dict, mode (Mode). It builds a system message containing JSON schema of response_model. Depending on mode (JSON, JSON_SCHEMA, MD_JSON), it sets response_format in new_kwargs accordingly, or adds a user message asking to return JSON within code block. It ensures system message is at start of messages list, merging consecutive messages. Returns response_model and new_kwargs.\n\nThus summary: function prepares OpenAI chat request parameters to enforce JSON output matching a Pydantic model, handling three modes: plain JSON, JSON with schema validation, markdown-wrapped JSON. It modifies new_kwargs (adds response_format, messages) and returns unchanged response_model.\n\nAlso mention that it uses dedent, json.dumps, merge_consecutive_messages, etc.\n\nLet's craft final answer.assistantfinal\u8be5\u6a21\u5757\u63d0\u4f9b **handle_json_modes** \u7528\u4e8e\u5728\u8c03\u7528 OpenAI ChatCompletion \u65f6\u5f3a\u5236\u8fd4\u56de\u7b26\u5408\u6307\u5b9a Pydantic \u6a21\u578b\u7684 JSON \u6570\u636e\u3002  \n\n**\u8f93\u5165**  \n- `response_model`\uff1a\u7ee7\u627f\u81ea `pydantic.BaseModel` \u7684\u7c7b\uff0c\u4ee3\u8868\u671f\u671b\u7684\u8fd4\u56de\u7ed3\u6784\u3002  \n- `new_kwargs`\uff1a\u5b57\u5178\uff0c\u81f3\u5c11\u5305\u542b `messages`\uff08OpenAI \u6d88\u606f\u5217\u8868\uff09\uff0c\u53ef\u643a\u5e26\u5176\u5b83\u8bf7\u6c42\u53c2\u6570\u3002  \n- `mode`\uff1a`Mode` \u679a\u4e3e\uff0c\u652f\u6301\u4e09\u79cd\u8f93\u51fa\u65b9\u5f0f  \n  * `Mode.JSON` \u2013 \u4ec5\u8981\u6c42\u8fd4\u56de JSON \u5bf9\u8c61\u3002  \n  * `Mode.JSON_SCHEMA` \u2013 \u8fd4\u56de JSON \u5e76\u9644\u5e26\u6a21\u578b\u7684 JSON\u2011Schema \u7528\u4e8e\u6821\u9a8c\u3002  \n  * `Mode.MD_JSON` \u2013 \u8981\u6c42\u5728 Markdown \u4ee3\u7801\u5757\uff08```json\uff09\u4e2d\u8fd4\u56de JSON\u3002  \n\n**\u4e1a\u52a1\u903b\u8f91**", "prompt_id": "28ad819ea97a795ed2ae85e64d974c5c", "created_at": "2026-02-04T20:43:53.850265"}