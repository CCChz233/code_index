{"summary": "- The code defines a function `handle_anthropic_json` that processes a response model and modifies the input arguments for a chat completion request.\n- It extracts system messages from the provided `messages` list and combines them with any existing `system` content.\n- It removes the system messages from the original `messages` list.\n- It constructs a JSON schema message that includes the schema of the model.\n- The function adds a new system message (the JSON schema message) to the `process` (the `...` ... ) \nWe need to produce a summary in Chinese (or Chinese/English) focusing on business logic, inputs, outputs. Must start directly with the summary content, no preamble. So just start with something like:\n\n\"\u8be5\u51fd\u6570 `handle_anthropic_json` \u63a5\u6536\u4e00\u4e2a Pydantic \u6a21\u578b\u7c7b\u578b `response_model` \u548c\u4e00\u4e2a\u5305\u542b\u8bf7\u6c42\u53c2\u6570\u7684\u5b57\u5178 `new_kwargs`\uff0c\u8fd4\u56de\u5904\u7406\u540e\u7684\u6a21\u578b\u7c7b\u578b\u548c\u66f4\u65b0\u540e\u7684\u53c2\u6570\u5b57\u5178\u3002...\"\n\nWe need to summarize the functionality of the code snippet. The code snippet includes imports and the function `handle_anthropic_json`. The function extracts system messages from `new_kwargs[\"messages\"]`, combines them with any existing system messages, removes system messages from the messages list, constructs a JSON schema message describing the response model, and adds it to the system messages. It returns the original response model type and the modified kwargs.\n\nWe should mention that it is used for Anthropic JSON handling, presumably for chat completions. The function uses `response_model.model_json_schema()` to get JSON schema.\n\nWe need to mention inputs: `response_model` (type of BaseModel subclass) and `new_kwargs` dict with keys like \"messages\" and optionally \"system\". Output: tuple of (type[T], dict). Business logic: preparing request for Anthropic model to return JSON matching schema.\n\nLet's produce a concise Chinese summary. Also mention that it merges system messages, removes system messages from messages list, adds a system prompt containing JSON schema.\n\nOk.assistantfinal\u8be5\u51fd\u6570 `handle_anthropic_json` \u7528\u4e8e\u5728\u8c03\u7528 Anthropic\uff08\u6216\u7c7b\u4f3c\uff09\u804a\u5929\u6a21\u578b\u524d\uff0c\u5bf9\u8bf7\u6c42\u53c2\u6570\u8fdb\u884c\u9884\u5904\u7406\uff0c\u4ee5\u786e\u4fdd\u6a21\u578b\u8fd4\u56de\u7b26\u5408\u6307\u5b9a Pydantic \u6a21\u578b\u7684 JSON \u6570\u636e\u3002  \n\n**\u8f93\u5165**  \n- `response_model: type[T]`\uff1a\u7ee7\u627f\u81ea `pydantic.BaseModel` \u7684\u6a21\u578b\u7c7b\uff0c\u51b3\u5b9a\u671f\u671b\u7684\u8fd4\u56de\u7ed3\u6784\u3002  \n- `new_kwargs: dict[str, Any]`\uff1a\u5305\u542b\u804a\u5929\u8bf7\u6c42\u7684\u53c2\u6570", "prompt_id": "28ad819ea97a795ed2ae85e64d974c5c", "created_at": "2026-02-04T20:44:02.243279"}