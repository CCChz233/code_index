{"summary": "- The test defines a Pydantic model `Summary` with a single field `summary` (string) and a description.\n- The `partial` DSL DSL? The code uses `instructor` library.\nWe need to summarize functionality. Provide business logic, inputs, outputs. Use Chinese. No \"This code does\". So start directly with summary. Let's craft.\n\nThe code is a pytest async test that uses OpenAI's async client wrapped by instructor library in TOOLS mode to create a partial streaming chat completion. It defines a Pydantic model Summary with a field summary. It sends system and user messages to summarize a text. It streams partial responses, each extraction is a Summary instance. It counts updates when the summary changes from previous. Finally asserts that there is exactly one update (i.e., only one partial update). So business logic: test that partial streaming returns only one update for a simple summarization.\n\nInputs: model name \"gpt-4o\", response_model Summary, messages list, stream=True. Output: stream of partial responses; test asserts updates count.\n\nLet's produce Chinese summary.assistantfinal\u5bf9 OpenAI \u5f02\u6b65\u804a\u5929\u63a5\u53e3\u8fdb\u884c\u529f\u80fd\u9a8c\u8bc1\uff1a  \n- \u5b9a\u4e49 Pydantic \u6570\u636e\u6a21\u578b `Summary`\uff0c\u4ec5\u5305\u542b `summary: str` \u5b57\u6bb5\u5e76\u9644\u5e26\u63cf\u8ff0\u3002  \n- \u4f7f\u7528 `instructor.from_openai` \u5c06 `AsyncOpenAI` \u5ba2\u6237\u7aef\u5305\u88c5\u4e3a **TOOLS** \u6a21\u5f0f\uff0c\u4ee5\u652f\u6301 DSL\u2011style \u7684 `create_partial` \u8c03\u7528\u3002  \n- \u8c03\u7528 `client.chat.completions.create_partial`\uff0c\u53c2\u6570\u4e3a  \n  * `model=\"gpt-4o\"`\uff08\u6a21\u578b\u540d\u79f0\uff09  \n  * `response_model=Summary`\uff08\u671f\u671b\u7684\u8fd4\u56de\u7ed3\u6784\uff09  \n  * `messages`\uff1a\u7cfb\u7edf\u63d0\u793a \u201cYou summarize text\u201d \u4e0e\u7528\u6237\u8bf7\u6c42 \u201cSummarize: Mary had a little lamb\u201d\u3002  \n  * `stream=True`\uff08\u5f00\u542f\u589e\u91cf\u6d41\u5f0f\u8fd4\u56de\uff09\u3002  \n- \u901a\u8fc7 `async for` \u8fed\u4ee3\u8fd4\u56de\u7684\u6d41\u5bf9\u8c61\uff0c\u6bcf\u6b21\u83b7\u53d6\u7684 `extraction` \u4e3a `Summary` \u5b9e\u4f8b\u3002\u8bb0\u5f55\u524d\u4e00\u6b21\u6458\u8981 `previous_summary`\uff0c\u82e5\u51fa\u73b0\u975e\u7a7a\u4e14\u4e0e\u524d\u4e00\u6b21\u4e0d\u540c\u5219\u8ba1\u6570 `updates`\u3002  \n- \u6700\u7ec8\u65ad\u8a00 `updates == 1`\uff0c\u5373\u5728\u6574\u4e2a\u6d41\u5f0f\u8fc7\u7a0b\u4e2d\u4ec5\u4ea7\u751f\u4e00\u6b21\u6458\u8981\u66f4\u65b0\uff0c\u9a8c\u8bc1\u90e8\u5206\u54cd\u5e94\uff08Partial\uff09\u673a\u5236\u5728\u8be5\u573a\u666f\u4e0b\u53ea\u8fd4\u56de\u5355\u4e00\u589e\u91cf\u3002  \n\n**\u8f93\u5165**\uff1a\u6a21\u578b\u540d\u79f0\u3001\u7ed3\u6784\u5316\u8fd4\u56de\u6a21\u578b\u3001", "prompt_id": "28ad819ea97a795ed2ae85e64d974c5c", "created_at": "2026-02-04T20:59:35.009143"}