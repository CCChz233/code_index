{"summary": "The code defines a `FileResponse` class (likely extending `StreamResponse`) that handles HTTP file serving with support for conditional requests, range requests, and compression. It determines the file path, stat info (including etag and **...** (continues ...). The prompt says: \"Summarize the functionality of the following code.\" The code is a snippet from aiohttp/web_fileresponse.py. The summary should start directly with the summary content, no \"This code does...\" etc. Should focus on business logic, inputs, outputs. Use Chinese (e.g., Chinese/English). So we need to produce a summary in Chinese (maybe with some English terms). Should be concise but cover main points: handling HTTP file response, reading request headers, handling conditional GET (If-None-Match, If-Modified-Since, etc.), handling range requests (partial content), setting appropriate status codes (200, 206, 304, 416, 403, 404), determining content type and encoding, using sendfile or reading file, handling errors, etc. Also mention environment variable AIOHTTP_NOSENDFILE, fallback content type, additional content types mapping, etc.\n\nThe code snippet includes imports, constants, and the async prepare method. The summary should describe that the method prepares the response based on request, determines file path, checks existence, permissions, file type, calculates ETag, Last-Modified, handles preconditions, range requests, sets headers, content length, content type, encoding, and then sends file using sendfile or fallback.\n\nWe need to start directly with the summary content, no preamble. Use Chinese. Let's produce a concise but thorough summary.\n\nLet's write:\n\n\"FileResponse \u7c7b\u5728 aiohttp \u4e2d\u5b9e\u73b0\u6587\u4ef6\u4e0b\u8f7d/\u6d4f\u89c8\u7684 HTTP \u54cd\u5e94\u3002\u5176\u6838\u5fc3 async prepare \u65b9\u6cd5\u63a5\u53d7 BaseRequest \u5bf9\u8c61\u4f5c\u4e3a\u8f93\u5165\uff0c\u6839\u636e\u8bf7\u6c42\u5934\uff08Accept-Encoding\u3001If-Match\u3001If-None-Match\u3001If-Modified-Since\u3001If-Unmodified-Since\u3001Range\u3001If-Range \u7b49\uff09\u6267\u884c\u4ee5\u4e0b\u4e1a\u52a1\u903b\u8f91\uff1a...\"\n\nThen list steps.\n\nMake sure not to start with \"This code does...\" but start directly with the summary.\n\nLet's produce final answer.assistantfinalFileResponse \u7c7b\u5728 aiohttp \u6846\u67b6\u4e2d\u5b9e\u73b0\u6587\u4ef6\u7684 HTTP \u54cd\u5e94\uff0c\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\u4f4d\u4e8e `async prepare(request)` \u65b9\u6cd5\uff1a\n\n1. **\u8f93\u5165**\uff1a`request`\uff08BaseRequest\uff09\uff0c\u5305\u542b\u8def\u5f84\u3001\u8bf7\u6c42\u65b9\u6cd5\u3001\u6240\u6709 HTTP \u5934\u90e8\u3002", "prompt_id": "28ad819ea97a795ed2ae85e64d974c5c", "created_at": "2026-02-04T20:36:44.204906"}