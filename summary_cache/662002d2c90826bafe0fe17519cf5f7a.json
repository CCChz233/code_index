{"summary": "- Asynchronous retry mechanism for a function that returns an OpenAI ChatCompletion.\n- Accepts a response model (pydantic BaseModel) for validation.\n- Tracks usage metrics (tokens etc.) across retries.\n- Emits hooks for events (completion arguments, response, parse errors.\n- Handles parsing/validation errors by modifying the request kwargs (re-ask).\n- Uses tenacity library for retry logic, with a default of 1 attempt.\n- On failure after all retries, raises InstructorRetryException with detailed info.\nWe need to produce summary in Chinese (maybe bilingual). Must start directly with summary content, no preamble. Provide business logic, inputs, outputs. So produce Chinese description. Let's craft.\n\nWe need to mention function name retry_async, its parameters, behavior, return, exceptions.\n\nLet's produce final answer.assistantfinal\u5b9e\u73b0\u5bf9\u5f02\u6b65 OpenAI **ChatCompletion** \u8c03\u7528\u7684\u81ea\u52a8\u91cd\u8bd5\u3002  \n\n**\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91**  \n1. **\u8f93\u5165**  \n   - `func`: \u5f85\u91cd\u8bd5\u7684\u5f02\u6b65\u51fd\u6570\uff0c\u8fd4\u56de `ChatCompletion`\u3002  \n   - `response_model`: \u53ef\u9009\u7684 Pydantic `BaseModel` \u7c7b\u578b\uff0c\u7528\u4e8e\u5bf9\u8fd4\u56de\u6570\u636e\u8fdb\u884c\u7ed3\u6784\u5316\u6821\u9a8c\u3002  \n   - `args / kwargs`: \u8c03\u7528 `func` \u65f6\u7684\u4f4d\u7f6e\u53c2\u6570\u548c\u5173\u952e\u5b57\u53c2\u6570\u3002  \n   - `context`: \u6821\u9a8c\u65f6\u7684\u989d\u5916\u4e0a\u4e0b\u6587\u4fe1\u606f\uff08\u53ef\u9009\uff09\u3002  \n   - `max_retries`: \u6700\u5927\u91cd\u8bd5\u6b21\u6570\u6216\u81ea\u5b9a\u4e49\u7684 `tenacity.AsyncRetrying` \u5bf9\u8c61\uff0c\u9ed8\u8ba4 1 \u6b21\u3002  \n   - `strict`: \u662f\u5426\u5f00\u542f\u4e25\u683c\u6821\u9a8c\uff08\u53ef\u9009\uff09\u3002  \n   - `mode`: \u8fd0\u884c\u6a21\u5f0f\uff0c\u9ed8\u8ba4 `Mode.TOOLS`\uff08\u5f71\u54cd\u9519\u8bef\u5904\u7406\u4e0e\u201cre\u2011ask\u201d\u7b56\u7565\uff09\u3002  \n   - `hooks`: `Hooks` \u5b9e\u4f8b\uff0c\u7528\u4e8e\u5728\u5173\u952e\u8282\u70b9\uff08\u8bf7\u6c42\u53c2\u6570\u3001\u54cd\u5e94\u3001\u89e3\u6790\u9519\u8bef\uff09\u89e6\u53d1\u56de\u8c03\u3002  \n\n2. **\u5904\u7406\u6d41\u7a0b**  \n   - \u521d\u59cb\u5316\u4f7f\u7528\u7edf\u8ba1\uff08token\u3001\u8d39\u7528\u7b49\uff09\u5e76\u6784\u9020 `tenacity` \u7684\u91cd\u8bd5\u7b56\u7565\u3002  \n   - \u8fdb\u5165\u91cd\u8bd5\u5faa\u73af\uff1a  \n     - \u901a\u8fc7 `hooks.emit_completion_arguments` \u628a\u8bf7\u6c42\u53c2\u6570\u5e7f\u64ad\u3002  \n     - \u8c03\u7528 `func(*args, **kwargs)` \u83b7\u53d6 `ChatCompletion`\uff0c\u968f\u540e `hooks.emit_completion_response` \u62a5\u544a\u54cd\u5e94\u3002  \n     - \u4f7f\u7528 `update_total_usage` \u7d2f\u8ba1\u672c\u6b21\u53ca\u5386\u53f2\u8c03\u7528\u7684 token \u4f7f\u7528\u91cf\u3002  \n     - \u8c03", "prompt_id": "28ad819ea97a795ed2ae85e64d974c5c", "created_at": "2026-02-04T20:39:12.016138"}